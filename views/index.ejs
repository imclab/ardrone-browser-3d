<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title><%= title %></title>
    <script src="/js/three.js/three.min.js"></script>
    <script src="/js/three.js/TrackballControls.js"></script>
    <script src="/js/three.js/extras/helpers/ArrowHelper.js"></script>
    <script src="/js/three.js/extras/helpers/AxisHelper.js"></script>
    <script src="/js/navdatas.js"></script>
    <script src="/js/three.js/ColladaLoader.js"></script>
    <script src="/js/jquery.min.js"></script>

    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/js/jquery.fullscreen-min.js"></script>
    <script type="text/javascript" src="/js/jquery.format-1.2.min.js"></script>
    <script type="text/javascript" src="/js/polyfills.js"></script>

    <script type="text/javascript" src="/js/drone.js"></script>
  </head>
  <body>
  <div id="telemetry"></div>

    <script>
$(function() {
  var theCamera;
  var theScene;
  var theRenderer;
  var theControls;
  var theDrone;

  function vectorArrow(x, y, z, v) {
    if (v.magnitude() < 0.0001) {
      return null;
    }
    var v = v.copy();
    var arrow = new THREE.ArrowHelper(
      new THREE.Vector3(v.x, v.y, v.z),
      new THREE.Vector3(x, y, z),
      v.magnitude() * 150,
      0x44444);
    return arrow;
  }

  function updateTelemetry(navdata) {
    // Show telemetry on page if desired.
  }

  function init() {
    m = new THREE.Matrix4();
    m.makeScale(1, 1, -1);
    console.log(m);
    theCamera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
    theCamera.position.x = 0;
    theCamera.position.y = 0;
    theCamera.position.z = 400;
    theCamera.lookAt(new THREE.Vector3(0, 0, 0));

    theScene = new THREE.Scene();
    theScene.add(theCamera);

    theDrone = new Drone();
    theScene.add(theDrone);

    // Connect to websocket.
    var hostname = document.location.hostname ? document.location.hostname : "localhost";
    droneSocket = io.connect('http://' + hostname);
    droneSocket.on('navdata', function(navdata) {
      if (!jQuery.isEmptyObject(navdata)) {
        theDrone.updateState(navdata);
        updateTelemetry(navdata);
      }
    });

    theScene.add(new THREE.AmbientLight(0x333333));
    var directionalLight = new THREE.DirectionalLight(0xaaaaaa);
    directionalLight.position.x = 500;
    directionalLight.position.y = 200;
    directionalLight.position.z = 500;
    directionalLight.position.normalize();
    theScene.add(directionalLight);
    directionalLight = new THREE.DirectionalLight(0xaaaaaa);
    directionalLight.position.x = -500;
    directionalLight.position.y = -200;
    directionalLight.position.z = 500;
    directionalLight.position.normalize();
    theScene.add(directionalLight);


    theRenderer = new THREE.WebGLRenderer({
    'antialias': true
    });
    theRenderer.setSize(window.innerWidth, window.innerHeight);
    theRenderer.setClearColorHex(0xeeeeee, 1);

    // trackback _controls settings.
    var radius = 60;
    theControls = new THREE.TrackballControls(theCamera, theRenderer.domElement);
    theControls.rotateSpeed = 0.5;
    theControls.zoomSpeed = 1.2;
    theControls.panSpeed = 0.2;
    theControls.noZoom = false;
    theControls.noPan = false;
    theControls.staticMoving = false;
    theControls.dynamicDampingFactor = 0.3;
    theControls.minDistance = radius * 1.1;
    theControls.maxDistance = radius * 100;
    theControls.keys = [65, 83, 68]; // [ rotateKey, zoomKey, panKey ]

    document.body.appendChild(theRenderer.domElement);
  }


  function animate() {
    requestAnimationFrame(animate);
    theControls.update();
    theRenderer.render(theScene, theCamera);
  }


  init();
  animate();

});
    </script>
  </body>
</html>
